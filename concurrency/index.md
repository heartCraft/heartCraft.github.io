# Concurrency

线程安全的本质是：管理对（共享的，可变的）状态的访问。

* 共享：可被多个线程访问
* 可变：变量的值可在生命周期中改变

synchronized(独占锁)；volatile；显示锁；原子变量

### synchronized
synchronized块有两部分：锁对象本身，被锁保护的代码块。

synchronized方法是用锁保护整个方法体的synchronized块，其锁对象是该方法所在的对象本身（静态synchronized方法从Class对象上获取锁）

### 锁对象
每个Java对象都可以隐式的成为锁对象，称为**内部锁**或**监视器锁**,在Java中扮演了**互斥锁**的角色。

**可重入**：每个线程可获得它自己已占有的锁。

通过为每个锁关联**一个请求计数**和**一个占有它的线程**实现

* 当计数为0时，表示锁未被占有；
* 当线程占有一个（未被占有）的锁时，记录该线程，请求计数置为1;
* 同一线程再次请求该锁时，计数递增；
* 每次占有线程退出synchronized块是，计数值递减；
* 知道计数为0，表示该锁被释放。
